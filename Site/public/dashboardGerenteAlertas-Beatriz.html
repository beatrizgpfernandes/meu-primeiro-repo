<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Métricas Gerente - GateWatch</title>
    <link rel="stylesheet" href="./CSS/styleDashboards.css">
    <link rel="stylesheet" href="./CSS/dashboardBeatriz.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="listarTotens(), totemMaiorAlerta(), diaMaiorAlerta(), gerarGraficoFrequenciaAlertas(), gerarGraficoPassageirosPorMes()">

    <div class="conteudoPagina">
        <div class="boxLateral">
            <div class="boxIdentificacao">
                <h1 class="fonte_perfil" id="nome_perfil"></h1>
                <h3>GERENTE DE DADOS</h3>
            </div>
            <div class="boxOpcoes">
                <div class="box">TENDÊNCIAS</div>
                <a
                    href="https://bandteccom-my.sharepoint.com/:x:/r/personal/felipe_nogueira_sptech_school/_layouts/15/doc2.aspx?sourcedoc=%7B2C447587-16DA-4CF9-A5B1-0F51B1FB95C3%7D&file=DashboardWebCrawler.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&ct=1730116379171&wdOrigin=OFFICECOM-WEB.MAIN.REC&cid=e50e6cf2-9a29-4df0-99db-651175d6dc5b&wdPreviousSessionSrc=HarmonyWeb&wdPreviousSession=8d45903a-d7da-4337-b5a8-bbb41545c8c3">
                    <div class="box" style="background-color: #41446877;">ALERTAS</div>
                </a>
                <a href="cadastroTotens.html">
                    <div class="box">TOTENS</div>
                </a>
            </div>
            <a href="cadastro.html">
                <div class="boxSair">SAIR</div>
            </a>
        </div>
        <div class="conteudoMetricas">
            <div class="boxTitulo">
                <div class="titulo" style="display: flex; align-items: center;">ANÁLISE MENSAL DOS ALERTAS</div>
                <div class="selecionarTotem1">
                    <div class="boxLogo">
                        <img src="Images/gwLogo_black.png" alt="" style="width: 21%; padding-bottom: 4%;">
                    </div>
                </div>
            </div>
            <div class="boxConteudoMetricas" style="display: flex; justify-content: center; align-items: center;">
                <div class="boxGeralKpiWebCrawler">
                    <div class="boxGeralKpi">
                        <div class="divSelect">
                            <select id="listaMeses">
                                <option value="" selected disabled>Selecione um Mês</option>
                            </select>
                        </div>
                        <div class="divKpis">
                            <div class="boxKpiTotem">
                                <div class="boxMetrica">
                                    <div class="divLinha"></div>
                                    <div class="divMetrica">
                                        <h1>TOTEM COM MAIS ALERTAS</h1>
                                        <h2><span id="TotemMaisAlerta"></span></h2>
                                        <div class="divAjuda">
                                            <img src="Images/iconAjuda.png" alt="" style="width: 12%;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="boxKpiDia">
                                <div class="boxMetrica">
                                    <div class="divLinha"></div>
                                    <div class="divMetrica">
                                        <h1>DIA COM MAIS ALERTAS</h1>
                                        <h2><span id="DiaMaisAlerta"></span></h2>
                                        <div class="divAjuda">
                                            <img src="Images/iconAjuda.png" alt="" style="width: 12%;"
                                                onclick="detalhesMetrica()">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="boxPassageirosXMeses">
                        <div class="boxGrafico">
                            <div class="boxTituloGrafico">
                                <span>QUANTIDADE DE PASSAGEIROS POR MÊS DO ANO</span>
                            </div>
                            <div class="divGraficoPass">
                                <canvas id="graficoPassageiros" width="1100" height="350"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="boxGeralAlertasEPassageiros">
                    <div class="divFreqAlertas">
                        <div class="divTituloESelect">
                            <span>QUANTIDADE DE PASSAGEIROS POR MÊS DO ANO</span>
                            <select id="listaTotens">
                                <option value="" selected disabled>Selecione um Totem</option>
                            </select>
                        </div>
                        <div class="divGrafFreqAlertas">
                            <canvas id="graficoFrequenciaAlertas" width="1220" height="400"></canvas>
                        </div>
                    </div>
                    <div class="divAlertasXPassageiros">
                        <div class="divTituloAlerXPass">
                            <span>RELAÇÃO ENTRE ALERTAS E PASSAGEIROS</span>
                        </div>
                        <div class="divGrafAlerXPass">
                            <canvas id="graficoAlertasXPassageiros" width="520" height="390"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



</body>

</html>

<script>

    const nomeUsuario = sessionStorage.getItem('NOME_USUARIO');
    const fkCompanhia = sessionStorage.getItem('FK_COMPANHIA')



    if (nomeUsuario) {
        document.getElementById('nome_perfil').textContent = nomeUsuario;
    } else {
        document.getElementById('nome_perfil').textContent = 'Usuário não identificado';
    }




    function totemMaiorAlerta() {
        fetch("/totens/totemMaiorAlerta", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO listar()!")

            if (resposta.ok) {
                console.log("Função listar(): ")

                resposta.json().then(function (resposta) {
                    var dados = resposta[0];

                    console.log(dados);
                    TotemMaisAlerta.innerHTML = dados.nome;
                })
            }
        })

    }

    function diaMaiorAlerta() {
        fetch("/totens/diaMaiorAlerta", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO listar()!")

            if (resposta.ok) {
                console.log("Função listar(): ")

                resposta.json().then(function (resposta) {
                    var dados = resposta[0];

                    console.log(dados);
                    DiaMaisAlerta.innerHTML = dados.dia;
                })
            }
        })

    }



    function listarTotens() {
        listaTotens.innerHTML = "<option value='' selected disabled>Selecione um Totem</option>";
        fetch(`/totens/listarTotens/${fkCompanhia}`, {
            method: "GET",
        })
            .then(function (resposta) {
                return resposta.json();

            })
            .then(function (totens) {
                const listaTotens = document.getElementById("listaTotens");
                listaTotens.innerHTML = "";

                totens.forEach((to) => {
                    listaTotens.innerHTML += `<option value='${to.nome_totem}'>${to.nome_totem}</option>`;
                });
            })
            .catch(function (erro) {
                console.log(`#ERRO: ${erro}`);
            });
    }






    // Estrutura dos Gráficos
    function gerarGraficoFrequenciaAlertas() {
        // Dados fictícios para a frequência de alertas nos dias do mês
        const diasDoMes = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];
        const frequenciaAlertas = [5, 10, 7, 3, 8, 12, 4, 6, 9, 15, 14, 7, 5, 11, 8, 13, 10, 9, 12, 16, 14, 7, 9, 11, 15, 18, 13, 10, 11, 12];

        // Configuração do gráfico
        const ctx = document.getElementById('graficoFrequenciaAlertas').getContext('2d');
        const graficoFrequenciaAlertas = new Chart(ctx, {
            type: 'line', // Tipo de gráfico: linha
            data: {
                labels: diasDoMes, // Eixo X: dias do mês
                datasets: [{
                    label: 'Frequência de Alertas', // Rótulo do gráfico
                    data: frequenciaAlertas, // Dados da frequência
                    fill: false, // Não preencher a área abaixo da linha
                    borderColor: '#18204b', // Cor da linha
                    tension: 0.1 // Tensão da linha (curvatura)
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Dia do Mês'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Frequência de Alertas'
                        },
                        beginAtZero: true
                    }
                }
            }
        });
    }





    // Dados simulados
    const passageiros = [50, 100, 150, 200, 250, 300, 350, 400, 450, 500];
    const alertas = [5, 10, 15, 20, 25, 30, 35, 40, 45, 50];

    // Dados do gráfico de dispersão
    const data = {
        datasets: [{
            label: 'Alertas vs Passageiros',
            data: passageiros.map((p, index) => ({
                x: p,
                y: alertas[index]
            })),
            backgroundColor: '#18204b',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    };

    // Configuração do gráfico
    const config = {
        type: 'scatter',
        data: data,
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Quantidade de Passageiros (milhares)'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Frequência de Alertas'
                    }
                }
            }
        }
    };

    // Criando o gráfico no canvas
    const ctx = document.getElementById('graficoAlertasXPassageiros').getContext('2d');
    new Chart(ctx, config);



    const meses = [
        'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
        'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'
    ];
    const passageirosMensais = [120, 150, 170, 140, 160, 180, 190, 200, 210, 220, 230, 240];

    // Função para gerar o gráfico de passageiros por mês
    function gerarGraficoPassageirosPorMes() {
        const ctx = document.getElementById('graficoPassageiros').getContext('2d');
        const graficoPassageiros = new Chart(ctx, {
            type: 'line', // Tipo de gráfico: linha
            data: {
                labels: meses, // Eixo X: meses do ano
                datasets: [{
                    label: 'Quantidade de Passageiros',
                    data: passageirosMensais, // Dados da quantidade de passageiros
                    fill: false, // Não preencher a área abaixo da linha
                    borderColor: '#18204b', // Cor da linha
                    tension: 0.1, // Tensão da linha (curvatura)
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Meses do Ano'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Quantidade de Passageiros'
                        },
                        beginAtZero: true // Começar o eixo Y do zero
                    }
                }
            }
        });
    }




</script>